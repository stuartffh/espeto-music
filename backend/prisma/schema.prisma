generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model admins {
  id           String    @id
  username     String    @unique
  password     String
  nome         String
  email        String?
  ativo        Boolean   @default(true)
  ultimoAcesso DateTime?
  permissoes   String?
  criadoEm     DateTime  @default(now())
  atualizadoEm DateTime @updatedAt
}

model pedidos_musica {
  id                  String      @id
  nomeCliente         String?
  musicaTitulo        String
  musicaYoutubeId     String
  musicaThumbnail     String?
  musicaDuracao       Int?
  status              String      @default("pendente")
  valor               Float
  pagamentoId         String?     @unique
  pagamentoCarrinhoId String?
  posicaoFila         Int?
  motivoRejeicao      String?
  moderadoPor         String?
  prioridade          Boolean     @default(false)
  dedicatoria         String?
  dedicatoriaDe       String?
  criadoEm            DateTime    @default(now())
  atualizadoEm        DateTime
  gift_cards          gift_cards?
  pagamentos          pagamentos? @relation(fields: [pagamentoId], references: [id])

  @@index([criadoEm])
  @@index([status])
  @@index([prioridade])
}

model pagamentos {
  id                      String          @id
  mercadoPagoPaymentId    String?         @unique
  mercadoPagoPreferenceId String?         @unique
  status                  String          @default("pending")
  valor                   Float
  metodoPagamento         String?
  emailPagador            String?
  cpfPagador              String?
  nomePagador             String?
  qrCode                  String?
  qrCodeText              String?
  pixExpirationDate       DateTime?
  webhookData             String?
  lastWebhookUpdate       DateTime?
  criadoEm                DateTime        @default(now())
  atualizadoEm            DateTime
  pedidos_musica          pedidos_musica?

  @@index([status])
}

model configuracoes {
  id           String   @id
  chave        String   @unique
  valor        String
  descricao    String?
  tipo         String   @default("text")
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt
}

model estado_player {
  id                String   @id
  musicaAtualId     String?
  status            String   @default("stopped")
  tempoAtual        Float    @default(0)
  volume            Int      @default(80)
  ultimaAtualizacao DateTime @default(now())
  criadoEm          DateTime @default(now())
  atualizadoEm      DateTime
}

model gift_cards {
  id                String          @id
  codigo            String          @unique
  valor             Float
  quantidadeMusicas Int
  usado             Boolean         @default(false)
  ativo             Boolean         @default(true)
  dataExpiracao     DateTime?
  usadoEm           DateTime?
  usadoPor          String?
  pedidoMusicaId    String?         @unique
  observacao        String?
  criadoEm          DateTime        @default(now())
  atualizadoEm      DateTime
  pedidos_musica    pedidos_musica? @relation(fields: [pedidoMusicaId], references: [id])

  @@index([codigo])
}

model carrinhos {
  id              String   @id
  sessionId       String
  nomeCliente     String?
  musicasTitulos  String
  musicasIds      String
  musicasThumbs   String
  musicasDuracoes String
  valorTotal      Float
  quantidadeItens Int
  expiraEm        DateTime
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime

  @@index([expiraEm])
  @@index([sessionId])
}

model sugestoes {
  id           String   @id
  categoria    String
  titulo       String
  youtubeId    String?
  thumbnail    String?
  tipo         String   @default("trending")
  ordem        Int      @default(0)
  ativo        Boolean  @default(true)
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@index([categoria, ativo])
}

model historico_buscas {
  id           String   @id
  termo        String
  categoria    String?
  resultados   Int      @default(0)
  vezesBuscado Int      @default(1)
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@index([termo])
}

model palavras_proibidas {
  id           String   @id
  palavra      String
  categoria    String   @default("AMBOS")
  severidade   String   @default("MEDIA")
  ativo        Boolean  @default(true)
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@index([categoria])
}

model rate_limits {
  id           String   @id
  ip           String
  contador     Int      @default(1)
  resetaEm     DateTime
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@index([resetaEm])
  @@index([ip])
}

model historico_musicas {
  id               String    @id @default(uuid())
  pedidoMusicaId   String?   // Referência ao pedido original (se existir)
  musicaTitulo     String
  musicaYoutubeId  String
  musicaThumbnail  String?
  musicaDuracao    Int?      // Duração em segundos
  nomeCliente      String?
  valor            Float     @default(0)
  inicioReproducao DateTime  @default(now())
  fimReproducao    DateTime? // Quando a música terminou
  duracaoTocada    Int?      // Tempo efetivamente tocado em segundos
  tipo             String    @default("cliente") // cliente, ambiente, admin
  observacao       String?
  criadoEm         DateTime  @default(now())

  @@index([inicioReproducao])
  @@index([tipo])
  @@map("historico_musicas")
}